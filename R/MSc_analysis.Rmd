---
title: "Analysis"
author: "Lusanda_Madula"
date: "2024-08-26"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load the packages

```{r}
library(tidyverse)
library(knitr)
library(kableExtra)
library(pheatmap)
library(RColorBrewer)
library(skimr)
library(visdat)
library(ggthemes)
library(viridis)
library(readxl)
```


```{r}
### Load the datasets

merged_data <- read_csv("Data_VEP_output/merged_data.csv", show_col_types = FALSE)

unique(merged_data$VCF_SOURCE)
covariates <- read_delim("Data_VEP_output/covariates.tsv",
                         delim = "\t", escape_double = FALSE,trim_ws = TRUE, show_col_types = FALSE)

### Remove the first name and live the second name in the vcf source 
merged_data <- merged_data %>% 
                 mutate(patient_ID = sub("^[^_]+_[^_]+_[^_]+_(.*\\.vcf)$", "\\1", VCF_SOURCE))

### Remove the ".vcf" extension from all patient_ID values in the merged_data to match the format used in the covariates, and then drop the VCF_SOURCE column.

merged_data$patient_ID <- gsub("\\.vcf$", "", merged_data$patient_ID)
merged_data <- merged_data %>% select(-VCF_SOURCE)

### Rename the "GP2sampleID" column in the covariates dataset to "patient_ID" for consistency with the merged_data.

covariates <- covariates %>% rename(patient_ID = GP2sampleID) %>% select(-AGE)

### Ensure patient_ID in both datasets are character type
merged_data$patient_ID <- as.character(merged_data$patient_ID)
covariates$patient_ID <- as.character(covariates$patient_ID)

### Merge data sets by 'patient_ID', keeping all rows from merged_data
### Perform left join (to keep all rows from merged_data and add matching rows from covariates)

resolved_cases <- merged_data %>% 
                    left_join(covariates,by = "patient_ID")

### Add the age of onset and the ID of the patients using the master key file

STELLENBOS_key_aug7_2024 <- read_csv("Data_VEP_output/STELLENBOS_key_aug7_2024.csv", show_col_types = FALSE)

### Convert columns to numeric if they are not already
STELLENBOS_key_aug7_2024$age_of_onset <- as.numeric(STELLENBOS_key_aug7_2024$age_of_onset)
STELLENBOS_key_aug7_2024$age <- as.numeric(STELLENBOS_key_aug7_2024$age)

### View a few rows of both columns to ensure data looks correct
head(STELLENBOS_key_aug7_2024[, c("age_of_onset", "age")])

### Replace empty spaces with NA for both 'age_of_onset' and 'age' columns
STELLENBOS_key_aug7_2024$age_of_onset[STELLENBOS_key_aug7_2024$age_of_onset == ""] <- NA
STELLENBOS_key_aug7_2024$age[STELLENBOS_key_aug7_2024$age == ""] <- NA

### Convert both columns to numeric (will convert any non-numeric values to NA)
STELLENBOS_key_aug7_2024$age_of_onset <- as.numeric(STELLENBOS_key_aug7_2024$age_of_onset)
STELLENBOS_key_aug7_2024$age <- as.numeric(STELLENBOS_key_aug7_2024$age)
Master_key_file <- STELLENBOS_key_aug7_2024 %>% select(GP2sampleID,age_of_onset,sample_id)

resolved_cases <- left_join(resolved_cases,Master_key_file, by = c("patient_ID" = "GP2sampleID"))

### Extract the last exon and  from the 'AAChange.refGene' column

resolved_cases$nucleiotide_protein <- sub(".*(exon\\d+:[^,]+)$", "\\1", resolved_cases$AAChange.refGene)


### Extract the nucleotide change (starting with 'c.') and store it in a new column 'nucleotide_change'

resolved_cases$nucleotide_change <- sub(".*(c\\.[^:]+).*", "\\1", resolved_cases$nucleiotide_protein)

### Extract the protein change (starting with 'p.') and store it in a new column 'protein_change'

resolved_cases$protein_change <- sub(".*(p\\.[^,]+).*", "\\1",  resolved_cases$nucleiotide_protein)

### select only the essential columns

list_of_pathogenic_solved <- resolved_cases %>% 
                        select(patient_ID,SEX,age_of_onset,sample_id,
                               Chr,
                               HEROZYGOSITY_HOMOZYGOSITY,avsnp147,
                                Gene.refGene,nucleotide_change, CLNSIG,
                                    protein_change,SIFT_score:CADD_phred, contains("AF"))

write.csv(list_of_pathogenic_solved, "list_of_pathogenic_solved.csv", row.names = FALSE)

unique(list_of_pathogenic_solved$patient_ID) ### 12 patients in total having 41 variants.
unique(list_of_pathogenic_solved$protein_change)

### Group the data by chromosome to determine the number of variants per chromosome.

chr_resolved <- resolved_cases %>% 
                  group_by(Chr) %>% 
                    count

 
p <- chr_resolved %>% 
  ggplot(aes(x = reorder(Chr,-n), y = n, label = n))+
  geom_col(stat= "identity", color= "black", fill= "steelblue", width= 0.40) +
  geom_text(aes(label = n), vjust = -0.5, size = 4)+
  labs(x= "Type of chromosome ", y= "Number of variants")+
   theme_minimal()+
   theme(
    axis.text.x = element_text(vjust = 1, hjust = 1, size = 12),
    axis.text.y = element_text(size=12),     # Increase y-axis
    axis.title.x = element_text(size = 16),  # Increase x-axis title size
    axis.title.y = element_text(size = 16),# Increase y-axis title size
   plot.title = element_text(size = 20, hjust = 0.5))


 ### Automatically save the plot
ggsave("Figures/chromosome_plot_solved.png", p, width = 10, height = 6)
  



### Group the data by genes to count the number of variants associated with each gene.

genes_resolved <- resolved_cases %>% 
                    group_by(Gene.refGene) %>% summarise(n=n())

p <-  genes_resolved %>%
  ggplot(aes(x= reorder(Gene.refGene,-n), y= n, label = n)) +
  geom_col(stat= "identity", color= "black", fill= "steelblue", width = 0.40)+
  geom_text(aes(label = n), vjust = -0.5, size = 4)+
  labs(x= "Gene symbol", y= "Number of variants")+
  theme_minimal()+
   theme(
    axis.text.x = element_text(angle=45, vjust = 1, hjust = 1, size = 12),
    axis.text.y = element_text(size=12),     # Increase y-axis
    axis.title.x = element_text(size = 16),  # Increase x-axis title size
    axis.title.y = element_text(size = 16),# Increase y-axis title size
   plot.title = element_text(size = 20, hjust = 0.5)) # Increase title size and center it

  

###  Automatically save the plot
ggsave("Figures/genes_plot_solved.png", p, width = 10, height = 6)
  


### A Table for different chromosome type
chr_resolved %>% 
  arrange(desc(n)) %>% 
  kable(caption = "Variants present in different chromosome type") %>% 
  kable_styling(full_width = FALSE, position = "left")



### A Table for different gene type
genes_resolved %>%
  arrange(desc(n)) %>% 
  kable(caption = "Variants present in different") %>% 
  kable_styling(full_width = FALSE, position = "left")


### Create a new variable, where you see the row that is less than 50 write as a early onset of PD, and greater or equally to 50 indicate late onset of PD

resolved_cases <- resolved_cases %>% 
  mutate(early_late = ifelse(age_of_onset < 50, "early onset PD", "late onset PD"))


### Males versus females 
### Group the data by sex and early versus late onset to provide an explanation of how many individuals experienced early or late onset of Parkinson's disease (PD).

resolved_cases %>% 
  group_by(SEX) %>%
    count()

resolved_cases %>% 
  group_by(early_late,SEX) %>% 
    summarise(n=n())



### Create data frame for early onset cases

early_onset_df <- resolved_cases %>%
                    filter(early_late == "early onset PD") %>%
                      select(Chr,patient_ID,age_of_onset,
                               nucleotide_change,protein_change, 
                             sample_id, avsnp147, Gene.refGene) %>% distinct()

  write.csv(early_onset_df, "early_onset_solved_cases.csv", row.names = FALSE)

  
  unique(early_onset_df$Gene.refGene)

### Create data frame for late onset cases
late_onset_df <- resolved_cases %>%
                    filter(early_late == "late onset PD") %>% 
                      select(Chr, patient_ID, age_of_onset, 
                             nucleotide_change, protein_change,
                             sample_id,avsnp147, Gene.refGene) %>% distinct()

write.csv(late_onset_df, "late_onset_solved_cases.csv", row.names = FALSE)

unique(late_onset_df$Gene.refGene)

### Create a line graphs that illustrates the allele frequency across global and continental population groups.
x <- resolved_cases %>% 
select(avsnp147, starts_with("AF")) %>%
  arrange(AF) %>%
  distinct() %>% 
  pull(avsnp147)




allele_frequency_resolved <- resolved_cases %>% 
                                select(avsnp147, starts_with("AF")) %>% 
                                    pivot_longer(cols = starts_with("AF"), 
                                                names_to = "population", values_to = "af")
allele_frequency_resolved$avsnp147 <-  factor(allele_frequency_resolved$avsnp147,levels = rev(x))

allele_frequency_resolved %>% 
ggplot(aes(x = avsnp147, y = af, color = population, group=population)) +
  geom_line() +
  theme_minimal() +
  labs(x = "rsID", y = "Allele Frequency", title = "Allele Frequency in different Population") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
  #scale_color_viridis(discrete = TRUE)
```


# Import the unsolved cases

```{r}
merged_data_unsolved <- read_csv("Data_VEP_output/merged_data_unsolved.csv", show_col_types = FALSE)

unique(merged_data_unsolved$VCF_SOURCE)

### This operation removes the first name from the VCF source string, leaving only the second name, and updates the 'patient_ID' field with the resulting value.

merged_data_unsolved <- merged_data_unsolved %>% 
                         mutate(patient_ID = sub("^[^_]+_[^_]+_[^_]+_(.*\\.vcf)$", "\\1", VCF_SOURCE))


### Remove the ".vcf" extension from all patient_ID values in the merged_data to match the format used in the covariates, and then drop the VCF_SOURCE column.

merged_data_unsolved$patient_ID <- gsub("\\.vcf$", "", merged_data_unsolved$patient_ID)
merged_data_unsolved <- merged_data_unsolved %>% select(-VCF_SOURCE)


### Rename the "GP2sampleID" column in the covariates dataset to "patient_ID" for consistency with the merged_data.
covariates <- read_delim("Data_VEP_output/covariates.tsv",
                         delim = "\t", escape_double = FALSE,trim_ws = TRUE, show_col_types = FALSE)


covariates <- covariates %>% rename(patient_ID = GP2sampleID)

### Ensure that the patient_ID column in both datasets is of character type for consistency.

merged_data_unsolved$patient_ID <- as.character(merged_data_unsolved$patient_ID)
covariates$patient_ID <- as.character(covariates$patient_ID)


### Merge the datasets by 'patient_ID' using a left join to retain all rows from merged_data and add the matching rows from covariates.

Unsolved_cases <- merged_data_unsolved %>% left_join(covariates,by = "patient_ID")

### Add the age of onset and the ID of the patientsusing the master key file
STELLENBOS_key_aug7_2024 <- read_csv("Data_VEP_output/STELLENBOS_key_aug7_2024.csv",
                                     show_col_types = FALSE)
Master_key_file <- STELLENBOS_key_aug7_2024 %>% select(GP2sampleID, sample_id,age_of_onset, clinical_id)
Unsolved_cases <- left_join(Unsolved_cases,Master_key_file, by = c("patient_ID" = "GP2sampleID"))


### Extract the last exon and  from the 'AAChange.refGene' column

Unsolved_cases$nucleiotide_protein <- sub(".*(exon\\d+:[^,]+)$", "\\1", Unsolved_cases$AAChange.refGene)

### Extract the nucleotide change (starting with 'c.') and store it in a new column 'nucleotide_change'

Unsolved_cases$nucleotide_change <- sub(".*(c\\.[^:]+).*", "\\1", Unsolved_cases$nucleiotide_protein)

### Extract the protein change (starting with 'p.') and store it in a new column 'protein_change'

Unsolved_cases$protein_change <- sub(".*(p\\.[^,]+).*", "\\1",  Unsolved_cases$nucleiotide_protein)

### Extract the exon to be in a new column
Unsolved_cases$Exon <- str_extract(Unsolved_cases$nucleiotide_protein, "exon\\d+(?=:)")

### Filter and select select only the essential columns

list_of_pathogenic_unsolved <- Unsolved_cases %>% 
                                filter(str_detect(CLNSIG,
                               regex("(pathogenic|likely pathogenic)",
                                  ignore_case = TRUE))) %>% 
                                      select(patient_ID,SEX,age_of_onset,sample_id,Chr,POS,
                                   HEROZYGOSITY_HOMOZYGOSITY,avsnp147,
                                Gene.refGene,Exon,nucleotide_change,protein_change, CLNSIG,
                                    SIFT_score:CADD_phred, contains("AF")) %>% distinct()


write.csv(list_of_pathogenic_unsolved, "list_of_pathogenic_unsolved.csv", row.names = FALSE)
unique(list_of_pathogenic_unsolved$Gene.refGene)
unique(list_of_pathogenic_unsolved$avsnp147)
unique(list_of_pathogenic_unsolved$protein_change)

### Summaries how many where early and late onset based on the 17 variants (48 individual)

Early_onset_unsolved <- list_of_pathogenic_unsolved %>% filter(age_of_onset< 50)

Early_onset_unsolved %>% group_by(SEX) %>% summarise(n=n())
unique(Early_onset_unsolved$Gene.refGene)

Late_onset_unsolved <- list_of_pathogenic_unsolved %>% filter(age_of_onset >=50) 

Late_onset_unsolved %>% group_by(SEX) %>% count()
unique(Late_onset_unsolved$Gene.refGene)

### summarise the list of pathogenic in unsolved but using the bar graph.

unique(list_of_pathogenic_unsolved$patient_ID)
unique(list_of_pathogenic_unsolved$Gene.refGene)
list_of_pathogenic_unsolved %>% group_by(protein_change, Gene.refGene) %>% count() %>% distinct()


### Group the data by chromosome to determine the number of variants per chromosome.

chr_unsolved <- Unsolved_cases %>% 
                  group_by(Chr) %>% 
                   count

p <- chr_unsolved %>% 
  ggplot(aes(x = reorder(Chr, -n), y = n, label = n)) +
  geom_col(stat = "identity", color = "black", fill = "steelblue", width = 0.40) +
  geom_text(aes(label = n), vjust = -0.5, size = 4) +  # Position the number of variants on top of the bars
  labs(x = "Type of chromosome", y = "Number of variants")+
 theme_minimal()+
   theme(
    axis.text.x = element_text(vjust = 1, hjust = 1, size = 12),  # Increase x-axis text size
    axis.text.y = element_text(size = 12), # Increase y-axis text size
  axis.title.x = element_text(size=16),
   axis.title.y = element_text(size = 16),
    plot.title = element_text(size = 20, hjust = 0.5)) # Increase title size and center it


###  Automatically save the plot
ggsave("Figures/chromosomes_plot_unsolved.png", p, width = 10, height = 6)


### Group the data by genes to count the number of variants associated with each gene.

genes_unsolved <- Unsolved_cases %>% 
                 group_by(Gene.refGene) %>% summarise(n=n())

p <- genes_unsolved %>%
  ggplot(aes(x = reorder(Gene.refGene, -n), y = n, label = n)) +
  geom_col(stat = "identity", color = "black", fill = "steelblue", width = 0.40) +
  geom_text(aes(label = n), vjust = -0.5, size = 4) +  # Increase size of text on bars
  labs(x = "Gene symbol", y = "Number of variants") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 12),  # Increase x-axis text size
    axis.text.y = element_text(size = 12),    # Increase y-axis text
     axis.title.x = element_text(size=16),   # Increase x-axis text title
    axis.title.y = element_text(size = 16),  # Increase y-axis text title
    plot.title = element_text(size = 20, hjust = 0.5))

###  Automatically save the plot
ggsave("Figures/genes_plot_unsolved.png", p, width = 10, height = 6)


genes_unsolved %>%
  ggplot(aes(x = reorder(Gene.refGene, -n), y = n, label = n)) +
    geom_col(stat = "identity", color = "black", fill = "steelblue", width = 0.6) +  # Adjusted width for bars
    geom_text(aes(label = n), vjust = -0.5, size = 3) +  # Position the number of variants on top of the bars
    labs(title = "Number of variants per gene", 
         x = "Gene symbol", 
         y = "Number of variants") +
    theme_light() +  # Lighter background for a cleaner look
    theme(
      axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 12),
      axis.title.x = element_text(size = 12),  # Increased size for axis titles
      axis.title.y = element_text(size = 12),
      plot.title = element_text(size = 14, face = "bold", hjust = 0.5),  # Make the title more prominent
      panel.grid.major = element_line(color = "gray90"),  # Lighter grid lines for a softer look
      panel.grid.minor = element_blank()  # Remove minor grid lines for clarity
    )

### A table categorizing different chromosome types.

chr_unsolved %>% 
  arrange(desc(n)) %>% 
  kable(caption = "Variants present in different chromosome type") %>% 
  kable_styling(full_width = FALSE, position = "left")



### A Table categorizing different gene type

genes_unsolved %>%
  arrange(desc(n)) %>% 
  kable(caption = "Variants present in different") %>% 
  kable_styling(full_width = FALSE, position = "left")

### Create a new variable, where you see the row that is less than 50 write as a early onset of PD, and greater or equally to 50 indicate late onset of PD

Unsolved_cases <- Unsolved_cases %>% 
  mutate(early_late = ifelse(AGE < 50, "early onset PD", "late onset PD"))


### Males versus females 
### Group the data by sex and early versus late onset to provide an explanation of how many individuals experienced early or late onset of Parkinson's disease (PD)

Unsolved_cases %>% group_by(SEX) %>% count()

Unsolved_cases %>% 
  group_by(early_late,SEX) %>% 
  summarise(n=n()) ## would expect more late onset than early onset for unsolved cases because early onset is normal familial

### Create dataframe for early onset cases

early_onset_df_unsolved <- Unsolved_cases %>%
                filter(early_late == "early onset PD") %>% 
                  select(patient_ID, sample_id, age_of_onset,
                               nucleotide_change,protein_change, 
                              avsnp147, Gene.refGene) %>% distinct()

write.csv(early_onset_df_unsolved, "early_onset_unsolved_cases.csv", row.names = FALSE)


### Create dataframe for late onset cases
late_onset_df_unsolved <- Unsolved_cases %>%
                          filter(early_late == "late onset PD")%>% 
                            select(patient_ID, sample_id, age_of_onset,
                               nucleotide_change,protein_change, 
                                 avsnp147, Gene.refGene) %>% distinct()



write.csv(late_onset_df_unsolved, "late_onset_unsolved_cases.csv", row.names = FALSE)


### Import the dataset in which the variants were prioritized using MetaLR and MetaSVM

```{r}
merged_data_metalr_metaSVM <- read_csv("merged_data_metalr&metaSVM.csv", show_col_types = FALSE)
covariates <- read_delim("Data_VEP_output/covariates.tsv",
                         delim = "\t", escape_double = FALSE,trim_ws = TRUE, show_col_types = FALSE)
unique(merged_data_metalr_metaSVM$VCF_SOURCE)
unique(merged_data_metalr_metaSVM$avsnp147)

### Remove the first name and live the second name in the vcf source 

merged_data_metalr_metaSVM <- merged_data_metalr_metaSVM %>% 
                 mutate(patient_ID = sub("^[^_]+_[^_]+_[^_]+_(.*\\.vcf)$", "\\1", VCF_SOURCE))

### Remove the ".vcf" extension from all patient_ID values in the merged_data to match the format used in the covariates, and then drop the VCF_SOURCE column.

merged_data_metalr_metaSVM$patient_ID <- gsub("\\.vcf$", "", merged_data_metalr_metaSVM$patient_ID)
merged_data_metalr_metaSVM <- merged_data_metalr_metaSVM %>% select(-VCF_SOURCE)

### Rename the "GP2sampleID" column in the covariates dataset to "patient_ID" for consistency with the merged_data.

covariates <- covariates %>% rename(patient_ID = GP2sampleID) %>% select(-AGE)

### Ensure patient_ID in both datasets are character type

merged_data_metalr_metaSVM$patient_ID <- as.character(merged_data_metalr_metaSVM$patient_ID)
covariates$patient_ID <- as.character(covariates$patient_ID)

### Merge data sets by 'patient_ID', keeping all rows from merged_data
### Perform left join (to keep all rows from merged_data and add matching rows from covariates)

unsolved_metalLR_metaSVM <- merged_data_metalr_metaSVM %>% 
                    left_join(covariates,by = "patient_ID")
### Add the age of onset and the ID of the patients using the master key file

STELLENBOS_key_aug7_2024 <- read_csv("Data_VEP_output/STELLENBOS_key_aug7_2024.csv", show_col_types = FALSE)
### Convert columns to numeric if they are not already

STELLENBOS_key_aug7_2024$age_of_onset <- as.numeric(STELLENBOS_key_aug7_2024$age_of_onset)
STELLENBOS_key_aug7_2024$age <- as.numeric(STELLENBOS_key_aug7_2024$age)


### View a few rows of both columns to ensure data looks correct

head(STELLENBOS_key_aug7_2024[, c("age_of_onset", "age")])


### Replace empty spaces with NA for both 'age_of_onset' and 'age' columns

STELLENBOS_key_aug7_2024$age_of_onset[STELLENBOS_key_aug7_2024$age_of_onset == ""] <- NA
STELLENBOS_key_aug7_2024$age[STELLENBOS_key_aug7_2024$age == ""] <- NA

### Convert both columns to numeric (will convert any non-numeric values to NA)

STELLENBOS_key_aug7_2024$age_of_onset <- as.numeric(STELLENBOS_key_aug7_2024$age_of_onset)
STELLENBOS_key_aug7_2024$age <- as.numeric(STELLENBOS_key_aug7_2024$age)
Master_key_file <- STELLENBOS_key_aug7_2024 %>% select(GP2sampleID,age_of_onset,sample_id)

unsolved_metalLR_metaSVM <- left_join(unsolved_metalLR_metaSVM,Master_key_file,
                                      by = c("patient_ID" = "GP2sampleID"))

### Extract the last exon and  from the 'AAChange.refGene' column

unsolved_metalLR_metaSVM$nucleiotide_protein <- sub(".*(exon\\d+:[^,]+)$", "\\1", unsolved_metalLR_metaSVM$AAChange.refGene)


### Extract the nucleotide change (starting with 'c.') and store it in a new column 'nucleotide_change'

unsolved_metalLR_metaSVM$nucleotide_change <- sub(".*(c\\.[^:]+).*", "\\1", unsolved_metalLR_metaSVM$nucleiotide_protein)

### Extract the protein change (starting with 'p.') and store it in a new column 'protein_change'

unsolved_metalLR_metaSVM$protein_change <- sub(".*(p\\.[^,]+).*", "\\1",  unsolved_metalLR_metaSVM$nucleiotide_protein)

### Extract the exon to be in a new column

unsolved_metalLR_metaSVM$Exon <- str_extract(unsolved_metalLR_metaSVM$nucleiotide_protein, "exon\\d+(?=:)")


### select only the essential columns

pathogenic_unsolved_metaLR_metaSVM <- unsolved_metalLR_metaSVM %>% 
                                       filter(str_detect(CLNSIG,
                                        regex("(pathogenic|likely pathogenic)",
                                         ignore_case = TRUE))) %>% 
                                          select(patient_ID,SEX,age_of_onset,sample_id,
                                             HEROZYGOSITY_HOMOZYGOSITY,avsnp147,
                                             Gene.refGene,Exon,nucleotide_change,protein_change, CLNSIG,
                                               SIFT_score:CADD_phred, contains("AF")) %>% distinct()

unique(pathogenic_unsolved_metaLR_metaSVM$protein_change)
unique(pathogenic_unsolved_metaLR_metaSVM$avsnp147)
unique(pathogenic_unsolved_metaLR_metaSVM$Gene.refGene)
unique(pathogenic_unsolved_metaLR_metaSVM$patient_ID)
write.csv(pathogenic_unsolved_metaLR_metaSVM, "pathogenic_unsolved_metaLR_metaSVM.csv", row.names = FALSE)

unique(pathogenic_unsolved_metaLR_metaSVM$patient_ID)

list_of_pathogenic_unsolved <- read_csv("C:/Users/madul/OneDrive - Stellenbosch University/Stellenbosch University/Stellenbosch University/Masters/Positive_controls/list_of_pathogenic_unsolved.csv")
```


 # Imported Non-PD controls and aligned them to the 17 prioritized variants.
 
```{r}

combined <- read_table("C:/Users/madul/OneDrive - Stellenbosch University/Stellenbosch University/Stellenbosch University/Masters/Positive_controls/combined.vcf",col_names = FALSE)

### Name all the columns

colnames(combined) <- c("CHROM", "POS", "ID", "REF", "ALT", "QUAL", 
                        "FILTER", "INFO", "FORMAT", "GENOTYPE", "VCF_SOURCE")

any(is.na(combined))
sum(is.na(combined))


### Make the position column to be numeric

combined$POS <- as.numeric(as.character(combined$POS))

### Imported prioritized variants from unsolved cases.

list_of_pathogenic_unsolved <- read_csv("C:/Users/madul/OneDrive - Stellenbosch University/Stellenbosch University/Stellenbosch University/Masters/Positive_controls/list_of_pathogenic_unsolved.csv")

### Make the position column to be numeric

list_of_pathogenic_unsolved$POS <- as.numeric(list_of_pathogenic_unsolved$POS)

### Use the left join for alignment

list_of_pathogenic_unsolved <- list_of_pathogenic_unsolved %>% 
                                  select (-c(SEX,patient_ID ,age_of_onset, sample_id,
                                             SIFT_score,Polyphen2_HDIV_score, FATHMM_score,CADD_phred, 
                                              AF,AF_afr, AF_eas, AF_nfe, AF_sas, 
                                                nucleotide_change, HEROZYGOSITY_HOMOZYGOSITY, CLNSIG))


Non_PD_controls <- list_of_pathogenic_unsolved %>% distinct(POS) %>% 
                                left_join(combined
                                          , by= "POS") 


write.csv(Non_PD_controls, "Non_PD_control.csv", row.names = FALSE)

  
non_PD_frequency<- Non_PD_controls %>% 
                    group_by(POS,VCF_SOURCE) %>% count() %>% 
                     mutate(nn= ifelse(is.na(VCF_SOURCE), 0, n)) %>% 
                       group_by(POS) %>% 
                        summarise(total = sum(nn)) %>% 
                          mutate(Frequency_control=total/759*100)

write.csv(non_PD_frequency, "non_PD_frequency.csv", row.names = FALSE)

```






# Draw the heatmap

```{r}

### First install a package
install.packages("pheatmap")
### Load the library
library(pheatmap)

### Draw the heat map for different patients having different variants in different genes

ggplot(merged_data, aes(y= patient_ID, x = avsnp147, fill = HEROZYGOSITY_HOMOZYGOSITY)) +
  geom_tile() +
   geom_text(aes(label = HEROZYGOSITY_HOMOZYGOSITY),color = "white", size = 4)+
  facet_wrap(~Gene.refGene)+  ### I just i wanted to see the het=atmap for each gene so feel free to remove this face wrap.
  labs(
    title = "Heatmap of Heterozygosity vs Homozygosity",
    subtitle = "Variants present in different individuals",
    x = "Gene Type",
    y = "Patient ID",
    fill = "Heterozygosity/Homozygosity"
  ) +
  theme(
    axis.text.x = element_text(angle = 30, hjust = 1),  # Rotate x-axis labels 
    axis.text.y = element_text(size = 8)  # Adjust size in y-axis labels 
  )+
  theme_bw()  ### you can also change the theme and put your theme of interest like theme_minimal etc
  


## How many variants per gene

genes <- merged_data %>% 
  group_by(Gene.refGene) %>% summarise(n=n())

## Bar graph that shows previous creteria 
genes %>%
  ggplot(aes(x= reorder(Gene.refGene,-n), y= n, label = n)) +
  geom_col(stat= "identity", color= "black", fill= "steelblue", width = 0.40)+
  theme(axis.text.x = element_text(angle = 45, vjust  = 0.5, hjust = 1, size = 6))+
  labs(title = "Number of variants per gene",x= "Gene symbol", y= "Number of variants")+
  theme_minimal()



## Draw the scatter plot graph that shows the scores per individual. However all the scores that are greater 20 are all pathogenic.

merged_data %>%
  ggplot(aes(x = CADD_phred, y = avsnp147)) +
  geom_point(color = "steelblue", size = 2, alpha = 0.7) +  # A soft, professional blue color
  labs(
    title = "Relationship between CADD Phred Score and rsID",
    x = "CADD Phred Score",
    y = "Variant Identifier",
    caption = "Variant scores present per Individual"
  ) +
  theme_minimal()

## or can use the following code
merged_data %>%
  ggplot(aes(x = CADD_phred, y = avsnp147)) +
  geom_point(color = "steelblue", size = 2, alpha = 0.7) +  # Scatter plot with points
  geom_text(aes(label = CADD_phred), vjust = -0.5, color = "darkgray", size = 3) + 
  labs(
    title = "Relationship between CADD Phred Score and rsID",
    x = "CADD Phred Score",
    y = "Variant Identifier",
    caption = "Variant scores present per Individual"
  ) +
  theme_minimal()

## Filter only the rows that had pathogenic variants 
merged_data %>% filter(str_detect(CLNSIG, "Pathogenic")) %>% count()

```



































































































































































